{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to my Digital Garden","text":""},{"location":"#welcome-to-my-digital-garden","title":"Welcome to my Digital Garden","text":"<p>This page on Ness Labs succinctly summarizes what a \"Digital Garden\" is</p> <p>A digital garden is an online space at the intersection of a notebook and a blog, where digital gardeners share seeds of thoughts to be cultivated in public. Contrary to a blog, where articles and essays have a publication date and start decaying as soon as they are published, a digital garden is evergreen: digital gardeners keep on editing and refining their notes.</p> <p>I've always struggled with what to take notes in. I landed on Obsidian) a while back, and have been slowly building out my personal notebook. It's not perfect by any means, but it is straightforward, and the notes are just Markdown.</p>"},{"location":"#about-me","title":"About Me","text":"<p>I'm currently a Senior Cloud Solution Architect at Microsoft, specializing in Security. You can find me in all the usual places like LinkedIn</p>"},{"location":"Azure/Creating%20a%20Basic%20VPN%20Gateway/","title":"Creating a Basic VPN Gateway","text":"<p>The Basic VPN gateway is often all that's needed, and price-wise, it's around $30/month vs VpnGW1 at $136/month. However, due to the sunset of [Basic Public IPs] (https://azure.microsoft.com/en-us/updates/upgrade-to-standard-sku-public-ip-addresses-in-azure-by-30-september-2025-basic-sku-will-be-retired/  used by the Basic VPN gateway, creating a new instance of the Basic VPN Gateway is no longer possible via the portal. Thankfully, it's still possible via a ARM template.</p> <p>Prerequisites: - VNet with a Gateway Subnet already created - Basic Public IP with dynamic addressing</p> <p>ARM Template. Replace the parameters with the appropriate URLs of your resources.</p> <pre><code>{\n\n\u00a0 \u00a0 \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\n\n\u00a0 \u00a0 \"contentVersion\": \"1.0.0.0\",\n\n\u00a0 \u00a0 \"parameters\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \"virtualNetworkGateways_VPN_Gateway_name\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"defaultValue\": \"VPN_Gateway_Basic\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"string\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 },\n\n\u00a0 \u00a0 \u00a0 \u00a0 \"publicIPAddresses_VPN_PublicIP_externalid\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"defaultValue\": \"subscriptions/XXXXXX/resourceGroups/XXXXX/providers/Microsoft.Network/publicIPAddresses/XXXXX\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"string\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 },\n\n\u00a0 \u00a0 \u00a0 \u00a0 \"virtualNetworks_Main_externalid\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"defaultValue\": \"subscriptions/XXXXXX/resourceGroups/XXXXX/providers/Microsoft.Network/virtualNetworks/XXXXX\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"string\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 },\n\n\u00a0 \u00a0 \"variables\": {},\n\n\u00a0 \u00a0 \"resources\": [\n\n\u00a0 \u00a0 \u00a0 \u00a0 {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"type\": \"Microsoft.Network/virtualNetworkGateways\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"apiVersion\": \"2017-06-01\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"name\": \"[parameters('virtualNetworkGateways_VPN_Gateway_name')]\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"location\": \"eastus\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"properties\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"enablePrivateIpAddress\": false,\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"ipConfigurations\": [\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"name\": \"default\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"id\": \"[concat(resourceId('Microsoft.Network/virtualNetworkGateways', parameters('virtualNetworkGateways_VPN_Gateway_name')), '/ipConfigurations/default')]\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"properties\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"privateIPAllocationMethod\": \"Dynamic\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"publicIPAddress\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"id\": \"[parameters('publicIPAddresses_VPN_PublicIP_externalid')]\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"subnet\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"id\": \"[concat(parameters('virtualNetworks_Main_externalid'), '/subnets/GatewaySubnet')]\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ],\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"natRules\": [],\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"virtualNetworkGatewayPolicyGroups\": [],\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"disableIPSecReplayProtection\": false,\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"sku\": {\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"name\": \"Basic\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"tier\": \"Basic\"\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 },\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"gatewayType\": \"Vpn\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"vpnType\": \"RouteBased\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"activeActive\": false,\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"vpnGatewayGeneration\": \"Generation1\",\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"allowRemoteVnetTraffic\": false,\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \"allowVirtualWanTraffic\": false\n\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 \u00a0 \u00a0 }\n\n\u00a0 \u00a0 ]\n\n}\n</code></pre>","tags":["Azure"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/","title":"Defender for Endpoint on iOS","text":"","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#prerequisites","title":"Prerequisites","text":"<ul> <li>Intune and Defender correctly set up. See Fresh Tenant Setup for how to prepare a test tenant. </li> <li>Test devices. You'll want at least 2 iOS devices to compare unsupervised vs supervised on iOS.</li> </ul> <p>The deployment and configuration varies based on if the iOS devices are supervised or unsupervised.</p>","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#deploy-defender-endpoint-app-to-ios-devices","title":"Deploy Defender Endpoint App to iOS devices","text":"<p> Portal  Docs</p> <p>Applies to: Supervised and unsupervised devices</p> <ol> <li>Add the iOS store app for Microsoft Defender, target all users you want to have Defender for Endpoint. As of writing, the name in the App Store is Microsoft Defender: Security.    </li> </ol>","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#configure-defender-for-endpoint","title":"Configure Defender for Endpoint","text":"","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#app-supervision-policy","title":"App Supervision Policy","text":"<p> Portal  Docs</p> <p>Applies to: Supervised and unsupervised devices</p> <p>This is confusing in the docs, but because it uses a token that will be resolved on the device, you can safely deploy this policy to both supervised and unsupervised devices.</p> <ol> <li>Create an app configuration policy for Managed Devices for platform iOS and targeted app Microsoft Defender: Security    </li> <li>Use the configuration designer to set a string key/value pair    Key: <code>issupervised</code>    Type: <code>string</code>    Value: <code>{{issupervised}}</code> </li> <li>Target both supervised and unsupervised devices. </li> </ol>","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#onboarding-profiles","title":"Onboarding Profiles","text":"<p> Portal  Docs</p> <p>*Applies to:  Unsupervised devices</p> <p>For unsupervised devices, there are two ways to finalize the configuration of Defender for Endpoint after its been deployed.</p> <p>Zero-Touch onboarding: This automatically configures Defender for Endpoint without any user interaction. Recommended. Simplified onboarding: This requires users to open Defender to finalize onboarding before the VPN functions.</p> <ol> <li>Create an device configuration policy for iOS/iPadOS devices with the template type VPN with the following settings    Connection Name = <code>Microsoft Defender for Endpoint</code>    VPN server address = <code>127.0.0.1</code>    Auth method = <code>Username and password</code>    Split Tunneling = <code>Disable</code>    VPN identifier = <code>com.microsoft.scmx</code>    For Zero-Touch onboarding:    Key/Value Pairs:       Key: <code>SilentOnboard</code>       Value: <code>True</code>   For Simplified onboarding:   Key/Value Pairs:       Key: <code>AutoOnboard</code>       Value: <code>True</code>    Type of Automatic VPN = On-demand VPN    Add a on-demand rule:       I want to do the following:  <code>Connect VPN</code>       I want to restrict to: <code>All domains</code> </li> <li>To prevent users from disabling the VPN in iOS Settings, set    Block users from disabling automatic VPN: <code>Yes</code> </li> <li>To disable the On/Off Toggle for the VPN in the Defender app itself, add the following key/value pair:    Key: <code>EnableVPNToggleInApp</code>    Value: <code>TRUE</code> </li> <li>Target unsupervised devices</li> </ol>","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Defender%20for%20Endpoint%20on%20iOS/#control-filter","title":"Control Filter","text":"<p> Portal  Docs</p> <p>Applies to:  Supervised devices</p> <p>The Control Filter allows Defender for Endpoint's Web Protection without the loopback VPN whatsoever. This does not work with other always-on VPNs.</p> <ol> <li>Create a Device Config profile with the following settings:    Platform: <code>iOS/iPadOS</code>    Profile Type: <code>Templates</code>    Template Name: <code>Custom</code> </li> <li>Download the ControlFilterZeroTouch .mobileconfig profile and upload it.    </li> <li>Target supervised devices. If you accidently target unsupervised it won't apply on those.</li> </ol>","tags":["M365","Defender","iOS","Intune"]},{"location":"M365/Fresh%20Tenant%20Setup/","title":"Fresh Tenant Setup","text":"<p>These are the steps I typically take to set up a fresh M365 E5 tenant. This is not complete. I'm documenting this (finally) as I rebuild a new test tenant.</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#azure-ad","title":"Azure AD","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#azure-ad-connect","title":"Azure AD Connect","text":"<p>Assuming you already have a Lab Domain Controller and Server for AAD Connect.</p> <p>Install AAD Connect, use Express Settings </p> <p>After it is finished, re-run and enable Hybrid Join</p> <p> </p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enable-group-writeback","title":"Enable Group Writeback","text":"<p>On the AzureAD Connect server, run the following commands to enable Group Writeback in Windows PowerShell <pre><code>Set-ADSyncScheduler -SyncCycleEnabled $false\nSet-ADSyncAADCompanyFeature -GroupWritebackV2 $true\nSet-ADSyncScheduler -SyncCycleEnabled $true\nStart-ADSyncSyncCycle -PolicyType Initial\n</code></pre></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#hybrid-cloud-trust","title":"Hybrid Cloud Trust","text":"<p>Create AzureAD Kerberos Server</p> <pre><code># Specify the on-premises Active Directory domain. A new Azure AD\n# Kerberos Server object will be created in this Active Directory domain.\n$domain = \"contoso.com\"\n\n# Enter a UPN of an Azure Active Directory global administrator\n$userPrincipalName = \"admin@contoso.com\"\n\n# Enter a domain administrator username and password.\n$domainCred = Get-Credential\n\n# Create the new Azure AD Kerberos Server object in Active Directory\n# and then publish it to Azure Active Directory.\n# Open an interactive sign-in prompt with given username to access the Azure AD.\nSet-AzureADKerberosServer -Domain $domain -UserPrincipalName $userPrincipalName -DomainCredential $domainCred\n\n# Verify server\nGet-AzureADKerberosServer -Domain $domain -DomainCredential $domainCred -UserPrincipalName $userPrincipalName\n\nId                 : 17530\nUserAccount        : CN=krbtgt_AzureAD,CN=Users,DC=contoso,DC=com\nComputerAccount    : CN=AzureADKerberos,OU=Domain Controllers,DC=contoso,DC=com\nDisplayName        : krbtgt_17530\nDomainDnsName      : contoso.com\nKeyVersion         : 27591\nKeyUpdatedOn       : 10/13/2022 9:23:43 PM\nKeyUpdatedFrom     : CONTOSO-DC-01.contoso.com\nCloudDisplayName   : krbtgt_17530\nCloudDomainDnsName : contoso.com\nCloudId            : 17530\nCloudKeyVersion    : 27591\nCloudKeyUpdatedOn  : 10/13/2022 9:23:43 PM\nCloudTrustDisplay  :\n</code></pre>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#entra","title":"Entra","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#authentication-settings","title":"Authentication Settings","text":"<ul> <li>Enable Self Service Password Reset</li> <li>Enable FIDO2, Authenticator, Temporary Access Pass in Authentication Methods</li> <li>Disable verification options in the legacy MFA settings portal </li> <li>Disable Authentication methods in SSPR Authentication Methods </li> <li>Migrate to Converged Authentication Methods Policy </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#user-settings","title":"User Settings","text":"<ul> <li>Toggle Off<ul> <li>Users can register Applications</li> <li>Show keep user signed in</li> </ul> </li> <li>Toggle On<ul> <li>Restrict non-admin users from creating tenants</li> <li>Restrict access to Entra ID administration portal </li> </ul> </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#user-feature-settings","title":"User Feature Settings","text":"<ul> <li>Select All for Users can use preview features for My Apps</li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#device-settings","title":"Device Settings","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#entraid-local-admin-password-solution","title":"EntraID Local Admin Password Solution","text":"<p>[!tip] LAPS docs</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enterprise-state-roaming","title":"Enterprise State Roaming","text":"<p>Enable Enterprise State Roaming </p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#identity-protection","title":"Identity Protection","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#multifactor-authentication-registration-policy","title":"Multifactor authentication registration policy","text":"<ul> <li>Create a AAD group called Service Accounts, add the AzureAD Connect sync account</li> <li>Enable the policy, targeting all users and excluding </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#diagnostic-settings","title":"Diagnostic Settings","text":"<p> Portal  Docs</p> <ul> <li>Enable all diagnostic settings to log to your Sentinel's log analytics workspace   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#global-secure-access","title":"Global Secure Access","text":"<p>https://entra.microsoft.com/#view/Microsoft_Azure_Network_Access/Welcome.ReactView</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#intune","title":"Intune","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#tenant-administration","title":"Tenant Administration","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#defender-for-endpoint-connector","title":"Defender for Endpoint Connector","text":"<ul> <li>Enable compliance policy evaluation for all platforms</li> <li>Enable app sync</li> <li>Enable App protection policy evaluation </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#devices","title":"Devices","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enroll-devices","title":"Enroll Devices","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#windows-enrollment","title":"Windows Enrollment","text":"<p>Windows enrollment - Automatic Enrollment </p> <p>Windows enrollment - Autopilot deployment Profiles</p> <p>Create a new Autopilot deployment profile</p> <p> </p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#ios-enrollment","title":"iOS Enrollment","text":"<p>Configure Apple MDM Push Certificate Instructions: Get an Apple MDM Push certificate for Intune | Microsoft Learn</p> <p></p> <p>Enrollment Profile Configure an enrollment profile Enrollment type profiles - Microsoft Intune admin center</p> <p>Create a profile that allows user choice of type of device (corporate vs user), target all users. </p> <p>Apple Configurator Profile  Portal  Docs</p> <p>There are two options for Apple Config profile - with user affinity and without. For testing, enrollment with User Affinity with the Company Portal app mimics how devices might be distributed to end users. 1. Create a new Enrollment Profile. On the settings step, select:    User affinity: <code>Enroll with User Affinity</code>    Select where users must authenticate: <code>Company Portal</code> 2. Export the profile you just created. Copy the URL.     3. Create a csv file with the serial numbers of iPads you wish to enroll.    <code>Serial number,device details</code> 4. Upload the csv file in the portal under Devices. Assign the profile you just created.     5. In Apple Configurator, choose Settings -&gt; Servers. Click + to add a server. Add the URL you copied from step 2.     6. Connect a device, and at the main screen, click Prepare. Leave the default options unchanged.     7. Choose the Intune MDM server defined in Step 5.     8. Skip Apple Business Manager sign-in if prompted. At the Organization screen select a previous org or create a new one. This is shown in the settings app in iOS. 9. Choose to generate a new supervision Identity or reuse an existing one. 10. Choose which steps to display in the Setup Assistant. Click Prepare to start the process.</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#android-enrollment","title":"Android Enrollment","text":"<p>Instructions: Android device enrollment guide for Microsoft Intune | Microsoft Learn</p> <p>Managed Google Play Account Linking</p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#apps","title":"Apps","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#windows","title":"Windows","text":"<p>Add app -&gt; Microsoft 365 Apps for Windows 10 and Later. Assign to all devices.</p> <p> </p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#ios","title":"iOS","text":"<p> Portal  Docs</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#defender-for-endpoint-on-ios","title":"Defender for Endpoint on iOS","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#endpoint-security","title":"Endpoint security","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#endpoint-detection-and-response","title":"Endpoint detection and response","text":"<p>Create a new policy targeting Windows 10,11 and Server. Target all devices.</p> <p></p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#security-baselines","title":"Security Baselines","text":"<p>Create a new Microsoft Defender for Endpoint Baseline policy and target all devices.</p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#account-protection","title":"Account Protection","text":"<p>After enabling LAPS in Entra, create a Windows LAPS profile and apply to all devices. </p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#m365-defender","title":"M365 Defender","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#email-collaboration","title":"Email &amp; collaboration","text":"<p>Policies &amp; Rules -&gt; Threat Policies -&gt; Preset Security Configurations</p> <p>Enable Standard Protection Preset Policies. </p> <p></p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#mdca","title":"MDCA","text":"<p>In the Defender Portal, go to Settings -&gt; Cloud Apps</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#system","title":"System","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#preview-features","title":"Preview Features","text":"<ul> <li>Toggle Enable</li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#ip-address-ranges","title":"IP address Ranges","text":"<ul> <li>If you have IP Ranges as Trusted Named Locations in EID, add them as Custom IP Address Ranges in MDCA with the category of Corporate   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#cloud-discovery","title":"Cloud Discovery","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#defender-for-endpoint","title":"Defender for Endpoint","text":"<ul> <li>Enforce App Access with Defender for Endpoint   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#user-enrichment","title":"User Enrichment","text":"<ul> <li>Enable User Enrichment   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#information-protection","title":"Information Protection","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#microsoft-information-protection","title":"Microsoft Information Protection","text":"<ul> <li>Enable automatically scan new files</li> <li>Enable scanning protected files. You'll need to go through the OAUTH grant process.   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#files","title":"Files","text":"<ul> <li>Enable file monitoring   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#app-governance","title":"App governance","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#service-status","title":"Service Status","text":"<ul> <li>Turn on app governance   </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#connected-apps","title":"Connected Apps","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#app-connectors","title":"App Connectors","text":"<ul> <li>Hit Connect an app, choose Microsoft 365 from the list. Select all options.</li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#siem-agents","title":"SIEM Agents","text":"<ul> <li>Add the Azure Sentinel integration  </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#mde","title":"MDE","text":"<p>In the Defender Portal, go to Settings -&gt; Endpoints</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#advanced-features","title":"Advanced Features","text":"<p>Set the features configured below</p> <p></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#defender-for-identity-mdi","title":"Defender for Identity (MDI)","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#general","title":"General","text":"<p>In the Defender Portal, go to Settings -&gt; Identities</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#sensors","title":"Sensors","text":"<p>Click +Add Sensor, and download the installer and copy the Access key </p> <p>Install the sensor on all DCs in AD. Use the access key when prompted by the installer. </p> <p>After installing, configure the Active Directory requirements listed below.</p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#ad-configuration","title":"AD Configuration","text":"<ul> <li>Configure Event Collection via GPO</li> <li>Configure Group Managed Service Account account<ul> <li>On the first DC<ul> <li>Create root KDS key   <code>powershell  Add-KdsRootKey -EffectiveTime ((get-date).addhours(-10))</code></li> <li>Purge kerberos tickets   <code>powershell   klist purge -li 0x3e7</code></li> <li>Create the gMSA   ``` powershell  New-ADServiceAccount accountname -PrincipalsAllowedToRetrieveManagedPassword \"Domain Controllers\" -DNSHostName accountname.domain.contoso.com <pre><code>        - Install the gMSA on the DC\n          ``` powershell\n          Install-ADServiceAccount -Identity 'accountname'\n</code></pre></li> </ul> </li> <li>On the other DCs, purge kerberos tickets and install the service account</li> <li>Add the gMSA in the portal   </li> </ul> </li> </ul>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#microsoft-purview","title":"Microsoft Purview","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#sensitivity-labels","title":"Sensitivity Labels","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enable-labeling-for-protected-content-pdfs","title":"Enable labeling for Protected content &amp; PDFs","text":"<ul> <li>Enable Sensitivity Labels for Protected Content</li> <li>Enable labeling support for PDFs</li> </ul> <p>With the SharePoint Module in PowerShell 5</p> <pre><code>connect-sposervice -url 'https://&lt;tenant&gt;-admin.sharepoint.com/'\nSet-SPOTenant -EnableAIPIntegration $true\nSet-SPOTenant -EnableSensitivityLabelforPDF $true\n</code></pre>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enable-labeling-for-containers","title":"Enable Labeling for Containers","text":"<p>In a fresh tenant, there will not be any EntraID group settings configured, so those need to be created. After that, you can enable the label sync.</p> <p>With the AzureADPreview module in Windows PowerShell (PS5)</p> <pre><code>Connect-AzureAd\n$TemplateId = (Get-AzureADDirectorySettingTemplate | where { $_.DisplayName -eq \"Group.Unified\" }).Id\n$Template = Get-AzureADDirectorySettingTemplate | where -Property Id -Value $TemplateId -EQ\n$setting = $Template.CreateDirectorySetting()\n$setting[\"EnableMIPLabels\"] = \"True\"\nNew-AzureADDirectorySetting -DirectorySetting $Setting\n</code></pre> <p>Then, with the ExchangeOnlineManagement module in PS5/PS7+</p> <pre><code>Connect-IPPSSession\nExecute-AzureAdLabelSync\n</code></pre>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#enable-co-authoring-for-encrypted-files","title":"Enable co-authoring for Encrypted Files","text":"<p>This can be done in the portal, or via PowerShell.</p> <p>With the ExchangeOnlineManagement module in PS5/PS7+</p> <pre><code>Connect-IPPSSession\nSet-PolicyConfig -EnableLabelCoauth:$true\n</code></pre>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#dlp","title":"DLP","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#endpoint-dlp","title":"Endpoint DLP","text":"","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#settings","title":"Settings","text":"<p> Portal  Docs</p> <p>In Settings, change the following: - Advanced classification scanning and protection: <code>On</code></p>","tags":["M365"]},{"location":"M365/Fresh%20Tenant%20Setup/#mip-scanner","title":"MIP Scanner","text":"<p> Portal  Docs</p> <p>Prerequisites - Service account in AD, exclude from MFA registration and CAs - SQL server for the scanner, as well as a windows server.</p> <p>Deployment 1. Create a Scanner Cluster     2. Create a Content Scan Job. Be sure to disable any of the auto options - this will just be for scanning.    </p>","tags":["M365"]}]}